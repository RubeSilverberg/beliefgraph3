<!DOCTYPE html>
<html>
<head>
    <title>Debug Virgin Edge Issue</title>
    <script src="https://unpkg.com/cytoscape@3.23.0/dist/cytoscape.min.js"></script>
</head>
<body>
    <div id="cy" style="width: 100%; height: 400px; border: 1px solid #ccc;"></div>
    <div id="debug" style="margin-top: 20px; font-family: monospace; white-space: pre-line;"></div>
    
    <script type="module">
        import { NODE_TYPE_FACT, NODE_TYPE_ASSERTION } from './config.js';
        import { computeVisuals, getEdgeLabel } from './visuals.js';
        
        // Create a simple test case
        const cy = cytoscape({
            container: document.getElementById('cy'),
            elements: [
                { data: { id: 'fact1', type: NODE_TYPE_FACT, label: 'New Fact', prob: 0.995 } },
                { data: { id: 'belief1', type: NODE_TYPE_ASSERTION, label: 'New Belief' } },
                { data: { id: 'edge1', source: 'fact1', target: 'belief1', weight: 0.6 } }
            ],
            style: [
                {
                    selector: 'node',
                    style: {
                        'label': 'data(label)',
                        'text-valign': 'center',
                        'text-halign': 'center',
                        'background-color': '#ddd',
                        'border-width': 2,
                        'border-color': '#666'
                    }
                },
                {
                    selector: 'edge',
                    style: {
                        'line-color': 'data(lineColor)',
                        'target-arrow-color': 'data(lineColor)',
                        'target-arrow-shape': 'triangle',
                        'width': 3,
                        'label': 'data(label)',
                        'font-size': '12px'
                    }
                }
            ],
            layout: { name: 'grid', rows: 1 }
        });
        
        // Mock getBayesMode function
        window.getBayesMode = () => 'lite';
        
        // Test the functions
        const edge = cy.getElementById('edge1');
        const fact = cy.getElementById('fact1');
        
        console.log('=== DEBUGGING VIRGIN EDGE ISSUE ===');
        console.log('Fact node data:', fact.data());
        console.log('Edge data:', edge.data());
        
        // Manual virginity check with the exact same logic
        const parentProb = edge.source().data('prob');
        const edgeWeight = edge.data('weight');
        const manualIsVirgin = typeof parentProb !== "number" || !edgeWeight || edgeWeight === 0;
        
        console.log('Manual virgin check:');
        console.log('  parentProb:', parentProb, '(type:', typeof parentProb, ')');
        console.log('  edgeWeight:', edgeWeight, '(truthy:', !!edgeWeight, ')');
        console.log('  manualIsVirgin:', manualIsVirgin);
        
        // Test getEdgeLabel
        const label = getEdgeLabel(edge);
        console.log('getEdgeLabel result:', label);
        
        // Test computeVisuals  
        computeVisuals(cy);
        
        console.log('After computeVisuals:');
        console.log('Edge lineColor:', edge.data('lineColor'));
        console.log('Edge absWeight:', edge.data('absWeight'));
        console.log('Edge label:', edge.data('label'));
        
        // Display results
        document.getElementById('debug').textContent = `
=== DEBUGGING VIRGIN EDGE ISSUE ===
Fact node prob: ${fact.data('prob')}
Edge weight: ${edge.data('weight')}
Edge label from getEdgeLabel(): "${label}"
Edge lineColor after computeVisuals(): ${edge.data('lineColor')}
Edge absWeight after computeVisuals(): ${edge.data('absWeight')}
Edge label after computeVisuals(): "${edge.data('label')}"

Expected behavior:
- Non-virgin edge should have gray lineColor (not orange #ff9900)
- Non-virgin edge should have empty label ""
- absWeight should be 0.6
        `;
    </script>
</body>
</html>
